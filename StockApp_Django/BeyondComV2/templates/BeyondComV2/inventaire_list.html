{% extends 'BeyondComV2/base.html' %}

{% block title %}Inventaires - Application de gestion des stocks{% endblock %}

{% block content %}
<div class="container">
    <h1>Inventaires</h1>
    <div class="mb-3">
        <a class="btn btn-primary mb-2" href="{% url 'inventaire_create' %}">Ajouter un produit</a>
        <form method="get" class="row g-3">
            <div class="col-md-3">
                <input type="text" name="search" class="form-control" placeholder="Rechercher..." value="{{ search_query }}">
            </div>
            <div class="col-md-2">
                <select name="department" class="form-control">
                    <option value="" selected>Tous les départements</option>
                    {% for department in departments %}
                    <option value="{{ department }}" {% if department == selected_department %}selected{% endif %}>{{ department }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <select name="etat" class="form-control">
                    <option value="" selected>Tous les états</option>
                    <option value="IN" {% if selected_etat == "IN" %}selected{% endif %}>IN</option>
                    <option value="OUT" {% if selected_etat == "OUT" %}selected{% endif %}>OUT</option>
                </select>
            </div>
            <div class="col-md-2">
                <select name="state" class="form-control">
                    <option value="" selected>Tous les états</option>
                    <option value="On" {% if selected_state == "On" %}selected{% endif %}>En marche</option>
                    <option value="Off" {% if selected_state == "Off" %}selected{% endif %}>Éteint</option>
                    <option value="Maintenance" {% if selected_state == "Maintenance" %}selected{% endif %}>Maintenance</option>
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">Filtrer</button>
            </div>
            <div class="col-md-1">
                <div class="d-grid">
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
                    <a class="btn btn-primary w-100 mb-2" href="{% url 'download_inventaire_csv' %}">
                        <i class="fas fa-file-download"></i>
                    </a>
                </div>
            </div>
        </form>
    </div>

    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Produit</th>
                <th>Département</th>
                <th>État</th>
                <th>Date d'entrée</th>
                <th>Quantité</th>
                <th>Dernière mise à jour</th>
                <th>État</th>
                <th>Garantie</th> <!-- Nouvelle colonne pour la garantie -->
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for inventaire in inventaires %}
            <tr>
                <td>{{ inventaire.inventaire_id }}</td>
                <td>{{ inventaire.produit.produit_name }}</td>
                <td>{{ inventaire.produit.departement.department_name }}</td>
                <td>{{ inventaire.etat_InOut }}</td>
                <td>{{ inventaire.date_in }}</td>
                <td>{{ inventaire.quantite_produit }}</td>
                <td>{{ inventaire.last_updated }}</td>
                <td>{{ inventaire.state }}</td>
                <td>
                    {% if inventaire.produit.warranty_isValid %}
                        <span class="badge bg-success">Valide</span>
                    {% else %}
                        <span class="badge bg-danger">Expirée</span>
                    {% endif %}
                </td>
                <td>
                    <a class="btn btn-secondary btn-sm" href="{% url 'inventaire_update' inventaire.pk %}">Modifier</a>
                    <a class="btn btn-danger btn-sm" href="{% url 'inventaire_delete' inventaire.pk %}">Supprimer</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
